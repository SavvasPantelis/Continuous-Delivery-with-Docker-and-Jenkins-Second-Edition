pipeline {
    agent any

    stages {
        stage('Run Tests') {
            steps {
                script {
                    if (env.BRANCH_NAME == 'main') {
                    if (env.BRANCH_NAME == 'master') {
                        echo 'Running CodeCoverage tests on main branch'
                        // Run CodeCoverage test
                        sh './gradlew test coverage'
                    } else if (env.BRANCH_NAME.contains('feature')) {
                        echo 'Running all tests except CodeCoverage on feature branch'
                        // Run all tests except CodeCoverage
                        sh './gradlew test'
                    } else {
                        echo 'Branch is not main or feature, failing pipeline'
                        error 'Invalid branch - pipeline failed'
                    }
                }
            }
        }
    }
}

